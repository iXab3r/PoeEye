<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:viewModels="clr-namespace:PoeBud.ViewModels"
                    xmlns:controls="http://metro.mahapps.com/winfx/xaml/controls"
                    xmlns:dataTypes="clr-namespace:PoeBud.OfficialApi.DataTypes">
    <DataTemplate DataType="{x:Type viewModels:PoeBudSettingsViewModel}">

        <DataTemplate.Resources>
            <ResourceDictionary>
                <ResourceDictionary.MergedDictionaries>
                    <ResourceDictionary Source="../Themes/Generic.xaml"/>
                </ResourceDictionary.MergedDictionaries>
            </ResourceDictionary>
        </DataTemplate.Resources>

        <Grid Margin="10,5" >
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0"
                      Orientation="Horizontal" Height="30" Margin="0,2">
                <Label Content="Enable overlay:" VerticalAlignment="Center" />
                <controls:ToggleSwitchButton Height="26"
                                         IsChecked="{Binding IsEnabled}" />
            </StackPanel>

            <StackPanel Grid.Row="1"
                      Orientation="Horizontal" Height="30" Margin="0,2">
                <Label Content="Get Set hotkey:" VerticalAlignment="Center" />
                <ComboBox IsEditable="False" 
                          Width="120"
                          ToolTip="Chat wheel hotkey" ItemsSource="{Binding HotkeysList}" SelectedValue="{Binding Hotkey}" />
            </StackPanel>

            <StackPanel Grid.Row="2"
                      Orientation="Horizontal" Height="30" Margin="0,2">
                <Label Content="Hide XP bar:" VerticalAlignment="Center" />
                <controls:ToggleSwitchButton Height="26"
                                         IsChecked="{Binding HideXpBar}" />
            </StackPanel> 

            <TextBox Grid.Row="3"
                 Margin="0, 5"
                 controls:TextBoxHelper.Watermark="e-mail"
                 Text="{Binding Username}"/>

            <PasswordBox Grid.Row="4" 
                     Margin="0, 5"
                     controls:TextBoxHelper.Watermark="password"
                     x:Name="LoginPasswordBox"/>

            <Grid Grid.Row="5" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="1"
                       Style="{StaticResource IconTextblock}" 
                       Foreground="Orange"
                       Margin="5"
                       FontSize="16"
                       VerticalAlignment="Center"
                       Visibility="{Binding LoginException, Converter={StaticResource NullToCollapsedConverter}}"
                       ToolTip="{Binding LoginException, Converter={StaticResource ExceptionToMessageConverter}}" 
                       Text="&#xF071;" />
                <controls:ProgressRing Grid.Column="1"
                                   Margin="5"
                                   Width="20" Height="20" Visibility="{Binding IsBusy, Converter={StaticResource VisibleToTrueConverter}}"/>

                <Button Grid.Column="2"
                    Width="100"
                    IsDefault="true"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource BoolInvertConverter}}"
                    Command="{Binding LoginCommand}" CommandParameter="{Binding ElementName=LoginPasswordBox}">
                    <Button.Content>
                        <TextBlock Text="Log in"/>
                    </Button.Content>
                </Button>
            </Grid>

            <GroupBox Grid.Row="6" 
                  IsEnabled="{Binding IsBusy, Converter={StaticResource BoolInvertConverter}}"
                  Margin="0, 10"
                  Header="Characters and stashes selection">
                <Grid>
                    <Grid.Resources>
                        <CollectionViewSource x:Key='charactersListSource' 
                                      Source="{Binding CharactersList}"
                                      IsLiveGroupingRequested="True">
                            <CollectionViewSource.GroupDescriptions>
                                <PropertyGroupDescription PropertyName="League"/>
                            </CollectionViewSource.GroupDescriptions>
                        </CollectionViewSource>
                    </Grid.Resources>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <ComboBox Grid.Row="0"
                      IsEnabled="{Binding CharactersList, Converter={StaticResource NullToFalseConverter}}" 
                      Margin="0, 5"
                      ItemsSource="{Binding Source={StaticResource charactersListSource}}"
                      SelectedItem="{Binding SelectedCharacter}">

                        <ComboBox.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.HeaderTemplate>
                                    <DataTemplate DataType="{x:Type dataTypes:ICharacter}">
                                        <TextBlock FontSize="14" FontWeight="Bold" Text="{Binding Name}"/>
                                    </DataTemplate>
                                </GroupStyle.HeaderTemplate>
                            </GroupStyle>
                        </ComboBox.GroupStyle>

                        <ComboBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type dataTypes:ICharacter}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock>
                                        <TextBlock.Inlines>
                                            <Run Text="{Binding Level}" FontWeight="SemiBold"/>
                                            <Run Text="{Binding Name}"/> (
                                            <Run Text="{Binding Class}"/> )
                                        </TextBlock.Inlines>
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <ListBox Grid.Row="1" 
                         Margin="0, 5"
                         MaxHeight="150"
                         IsEnabled="{Binding SelectedCharacterStash, Converter={StaticResource NullToFalseConverter}}" 
                         Visibility="{Binding SelectedCharacterStash, Converter={StaticResource NullToCollapsedConverter}}"
                         ItemsSource="{Binding SelectedCharacterStash}">
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type viewModels:TabSelectionViewModel}">
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox IsChecked="{Binding IsSelected}"  />
                                    <TextBlock Text="{Binding Name}" />
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </GroupBox>
        </Grid>

    </DataTemplate>
</ResourceDictionary>