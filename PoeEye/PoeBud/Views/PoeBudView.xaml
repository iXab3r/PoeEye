<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:viewModels="clr-namespace:PoeBud.ViewModels"
                    xmlns:controls="http://metro.mahapps.com/winfx/xaml/controls">

    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="pack://application:,,,/PoeShared;component/Themes/Generic.xaml" />
        <ResourceDictionary Source="pack://application:,,,/PoeShared;component/Themes/Styles.xaml" />
    </ResourceDictionary.MergedDictionaries>

    <DataTemplate DataType="{x:Type viewModels:PoeBudViewModel}">
        <Grid>

            <Canvas>
                <Rectangle Canvas.Top="{Binding WindowManager.ActiveWindow.StashBounds.Top}"
                           Canvas.Left="{Binding WindowManager.ActiveWindow.StashBounds.Left}"
                           Width="{Binding WindowManager.ActiveWindow.StashBounds.Width}"
                           Height="{Binding WindowManager.ActiveWindow.StashBounds.Height}"
                           Stroke="Red" StrokeThickness="3" Visibility="Collapsed" />

                <Grid
                    Canvas.Top="960" Canvas.Left="624" TextBlock.FontSize="20" TextBlock.Foreground="White"
                    Opacity="0.75"
                    Visibility="{Binding IsEnabled, Converter={StaticResource TrueToVisibleFalseToCollapsedConverter}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="30" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Grid.Column="0" Margin="50, 5, 0, 5">
                        <ContentPresenter Content="{Binding SolutionExecutor}" />
                    </Grid>

                    <Grid Grid.Row="1" Grid.Column="0" Margin="50, 5, 0, 5">
                        <TextBlock
                            MaxWidth="600"
                            Visibility="{Binding LastUpdateException, Converter={StaticResource NullToCollapsedConverter}}"
                            Foreground="Orange"
                            Text="{Binding LastUpdateException, StringFormat='&#xF071; {0}', Converter={StaticResource ExceptionToMessageConverter}}"
                            Style="{StaticResource IconTextBlock}" TextTrimming="WordEllipsis" />
                    </Grid>

                    <Grid Grid.Row="2" Grid.Column="0"
                          Visibility="{Binding StashUpdater, Converter={StaticResource NullToCollapsedConverter}, TargetNullValue={x:Static Visibility.Collapsed}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0"
                                    Margin="10, 0"
                                    Orientation="Horizontal"
                                    Visibility="{Binding StashUpdater.IsBusy, Converter={StaticResource TrueToVisibleFalseToCollapsedConverter}}">

                            <controls:ProgressRing
                                Height="18" Width="18"
                                IsActive="{Binding StashUpdater.IsBusy}" />
                            <TextBlock
                                Text="{Binding TimeTillNextUpdate, Converter={StaticResource TimeSpanToHumanReadableStringConverter}}"
                                Style="{StaticResource IconTextBlock}" 
                                Margin="5,0" />
                        </StackPanel>

                        <TextBlock Grid.Column="0"
                                   Margin="10,0"
                                   TextAlignment="Center"
                                   Visibility="{Binding StashUpdater.IsBusy, Converter={StaticResource TrueToCollapsedFalseToVisibleConverter}}"
                                   Text="{Binding TimeTillNextUpdate, StringFormat='&#xF017; {0}', Converter={StaticResource TimeSpanToHumanReadableStringConverter}}"
                                   Style="{StaticResource IconTextBlock}" />

                        <TextBlock Grid.Column="2"
                                   Text="{Binding Stash.Solutions.Length, StringFormat='Sets: {0}'}"
                                   Style="{StaticResource IconTextBlock}" Margin="10,0" />
                    </Grid>

                    <ContentPresenter Grid.Row="3" Grid.Column="0"
                                      Content="{Binding Stash}" />
                </Grid>

                <Border Canvas.Top="1065" Canvas.Left="546" Width="820" Background="#0C0C0C" Height="8" Opacity="0.95"
                        Visibility="{Binding HideXpBar, Converter={StaticResource TrueToVisibleFalseToCollapsedConverter}}" />

                <Image Source="{Binding UiOverlayPath}" />
            </Canvas>
        </Grid>
    </DataTemplate>
</ResourceDictionary>