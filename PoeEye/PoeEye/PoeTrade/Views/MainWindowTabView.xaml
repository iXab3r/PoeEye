<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="http://metro.mahapps.com/winfx/xaml/controls"
                    xmlns:componentModel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
                    xmlns:viewModels="clr-namespace:PoeEye.PoeTrade.ViewModels">
  <DataTemplate DataType="{x:Type viewModels:MainWindowTabViewModel}" >
    <Grid>
      <Grid.Resources>
        <CollectionViewSource x:Key='tradesListSource'
                              Source="{Binding TradesList.Items}"
                              IsLiveFilteringRequested="True"
                              IsLiveSortingRequested="True">
          <CollectionViewSource.SortDescriptions>
            <componentModel:SortDescription PropertyName="TradeState" Direction="Ascending" />
            <componentModel:SortDescription PropertyName="PriceInChaosOrbs" Direction="Ascending" />
          </CollectionViewSource.SortDescriptions>

        </CollectionViewSource>
      </Grid.Resources>

      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <ScrollViewer VerticalScrollBarVisibility="Auto"
                    IsTabStop="False"
                    Focusable="False"
                    MaxHeight="{Binding ActualHeight, RelativeSource={RelativeSource FindAncestor, AncestorType=ContentPresenter}, Mode=OneWay}">
        <Expander IsExpanded="{Binding Query.IsExpanded}" Margin="0">
          <Expander.Header>
            <StackPanel Orientation="Horizontal">
              <TextBlock Text="Query parameters" Margin="5,0" VerticalAlignment="Center" />
              <Button Content="Mark All as Read" Command="{Binding MarkAllAsReadCommand}" />
            </StackPanel>
          </Expander.Header>

          <StackPanel Orientation="Vertical">
            <controls:MetroContentControl Content="{Binding Query}" />
            <DockPanel>
              <Button HorizontalAlignment="Right" Width="150" Command="{Binding SearchCommand}"
                      CommandParameter="{Binding Query.PoeQueryBuilder}"
                      Content="Search" />
            </DockPanel>
          </StackPanel>
        </Expander>
      </ScrollViewer>

      <Expander Grid.Row="1"
                IsExpanded="{Binding TradesList.HistoricalTrades.IsExpanded}"
                Visibility="{Binding TradesList.HistoricalTrades.ItemsViewModels.Count, Converter={StaticResource ZeroToCollapsedConverter}}">
        <Expander.Header>
          <TextBlock>
            <Run Text="Trades history ( " />
            <Run ToolTip="Historical trades"
                 Text="{Binding TradesList.HistoricalTrades.ItemsViewModels.Count, Mode=OneWay, StringFormat=\{0\}}"
                 FontWeight="Bold" />
            <Run Text=" )" />
          </TextBlock>
        </Expander.Header>
        <ContentControl Content="{Binding TradesList.HistoricalTrades}" Margin="0" />
      </Expander>

      <Grid Grid.Row="2">

        <ItemsControl Margin="0,10,0,0"
                      ItemsSource="{Binding Source={StaticResource tradesListSource}}"
                      Style="{StaticResource VirtualizedItemsControlStyle}">
        </ItemsControl>
      </Grid>
    </Grid>
  </DataTemplate>
</ResourceDictionary>