<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:common="clr-namespace:PoeShared.Common;assembly=PoeShared"
                    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
                    xmlns:net="clr-namespace:FontAwesome.Net;assembly=FontAwesome.Net"
                    xmlns:filterExtension="clr-namespace:PoeEye.Utilities.FilterExtension"
                    xmlns:viewModels="clr-namespace:PoeEye.PoeTrade.ViewModels"
                    xmlns:poeTrade="clr-namespace:PoeEye.PoeTrade"
                    xmlns:utilities="clr-namespace:PoeEye.Utilities">

  <DataTemplate x:Key="PoeItemStatsTemplateKey" DataType="{x:Type common:IPoeItem}">
    <!-- Stats -->
    <Grid Margin="10,5">
      <Grid.Resources>
        <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}" x:Key="ItemStatValue">
          <Setter Property="Margin" Value="10, 0" />
          <Setter Property="HorizontalAlignment" Value="Center" />
          <Setter Property="VerticalAlignment" Value="Center" />
          <Setter Property="FontWeight" Value="Bold" />
        </Style>

        <Style TargetType="{x:Type Label}" BasedOn="{StaticResource {x:Type Label}}" x:Key="ItemStatHeader">
          <Setter Property="HorizontalContentAlignment" Value="Right" />
          <Setter Property="VerticalContentAlignment" Value="Center" />
          <Setter Property="FontWeight" Value="Bold" />
          <Setter Property="MinWidth" Value="50" />
          <Setter Property="Padding" Value="0" />
        </Style>

        <Style TargetType="{x:Type StackPanel}">
          <Setter Property="Orientation" Value="Horizontal"/>
        </Style>
      </Grid.Resources>
      <StackPanel Orientation="Vertical">

        <StackPanel Visibility="{Binding Quality, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="Quality" Style="{StaticResource ItemStatHeader}" />
          <TextBlock Text="{Binding Quality}" Style="{StaticResource ItemStatValue}"/>
        </StackPanel>

        <StackPanel Visibility="{Binding Level, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="Level" Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding Level}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding Physical, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="Phys." Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding Physical}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding Elemental, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="Elem." Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding Elemental}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding AttacksPerSecond, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="APS" Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding AttacksPerSecond}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding DamagePerSecond, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="DPS" Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding DamagePerSecond}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding PhysicalDamagePerSecond, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="pDPS" Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding PhysicalDamagePerSecond}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding ElementalDamagePerSecond, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="eDPS" Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding ElementalDamagePerSecond}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding Armour, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="Armour" Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding Armour}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding Evasion, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="Evasion" Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding Evasion}"  Style="{StaticResource ItemStatValue}"/>
        </StackPanel>

        <StackPanel Visibility="{Binding Shield, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="Shield" Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding Shield}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding BlockChance, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="Block" Style="{StaticResource ItemStatHeader}"/>
          <TextBlock Text="{Binding BlockChance}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>

        <StackPanel Visibility="{Binding CriticalChance, Converter={StaticResource NullToCollapsedConverter}}">
          <Label Content="Crit." Style="{StaticResource ItemStatHeader}" />
          <TextBlock Text="{Binding CriticalChance}" Style="{StaticResource ItemStatValue}" />
        </StackPanel>
      </StackPanel>


      <Grid.RowDefinitions>
        <RowDefinition Height="80*" />
        <RowDefinition Height="80*" />
      </Grid.RowDefinitions>



      <!-- Row 2 -->

    </Grid>
  </DataTemplate>

  <DataTemplate x:Key="PoeItemNameTemplateKey" DataType="{x:Type common:IPoeItem}">
    <TextBlock Text="{Binding ItemName, Mode=OneWay}">
      <TextBlock.Style>
        <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
          <Style.Triggers>
            <DataTrigger Binding="{Binding Rarity}" Value="{x:Static common:PoeItemRarity.Normal}">
              <Setter Property="Foreground" Value="{StaticResource PoeItemRarityNormalBrush}" />
            </DataTrigger>
            <DataTrigger Binding="{Binding Rarity}" Value="{x:Static common:PoeItemRarity.Magic}">
              <Setter Property="Foreground" Value="{StaticResource PoeItemRarityMagicBrush}" />
            </DataTrigger>
            <DataTrigger Binding="{Binding Rarity}" Value="{x:Static common:PoeItemRarity.Rare}">
              <Setter Property="Foreground" Value="{StaticResource PoeItemRarityRareBrush}" />
            </DataTrigger>
            <DataTrigger Binding="{Binding Rarity}" Value="{x:Static common:PoeItemRarity.Unique}">
              <Setter Property="Foreground" Value="{StaticResource PoeItemRarityUniqueBrush}" />
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </TextBlock.Style>
    </TextBlock>
  </DataTemplate>

  <DataTemplate x:Key="PoeItemModsTemplateKey" DataType="{x:Type common:IPoeItem}">
    <Grid>
      <Grid.Resources>
        <CollectionViewSource Source="{Binding Mods}" x:Key="ImplicitMods">
          <i:Interaction.Behaviors>
            <filterExtension:CollectionViewSourceFilteringBehavior>
              <x:Array Type="{x:Type filterExtension:IFilter}">
                <filterExtension:PropertyFilter PropertyName="ModType" Value="{x:Static common:PoeModType.Implicit}" />
              </x:Array>
            </filterExtension:CollectionViewSourceFilteringBehavior>
          </i:Interaction.Behaviors>
        </CollectionViewSource>
        <CollectionViewSource Source="{Binding Mods}" x:Key="ExplicitMods">
          <i:Interaction.Behaviors>
            <filterExtension:CollectionViewSourceFilteringBehavior>
              <x:Array Type="{x:Type filterExtension:IFilter}">
                <filterExtension:PropertyFilter PropertyName="ModType" Value="{x:Static common:PoeModType.Explicit}" />
              </x:Array>
            </filterExtension:CollectionViewSourceFilteringBehavior>
          </i:Interaction.Behaviors>
        </CollectionViewSource>
      </Grid.Resources>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="5" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>
      <ItemsControl Grid.Row="0" Grid.Column="0"
                    x:Name="ImplicitModsItemsControl"
                    ItemsSource="{Binding Source={StaticResource ImplicitMods}}" FontStyle="Italic" />
      <Border Grid.Row="1" Grid.Column="0"
              Visibility="{Binding ElementName=ImplicitModsItemsControl, Path=HasItems, Converter={StaticResource BoolFalseToCollapsedConverter}}"
              Height="5" BorderBrush="{StaticResource AccentColorBrush}" BorderThickness="0,1,0,0" />
      <ItemsControl Grid.Row="2" Grid.Column="0"
                    ItemsSource="{Binding Source={StaticResource ExplicitMods}}" />
    </Grid>
  </DataTemplate>

  <DataTemplate DataType="{x:Type viewModels:PoeTradeViewModel}">
    <ContentControl Margin="10">
      <Grid HorizontalAlignment="Center" >
        <Grid.RowDefinitions>
          <RowDefinition Height="40" />
          <RowDefinition Height="*" />
          <RowDefinition Height="30" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="100" />
          <ColumnDefinition Width="*" SharedSizeGroup="Content" />
        </Grid.ColumnDefinitions>

        <ContentControl Grid.Row="1" Grid.Column="0"
                        Margin="0,0,10,0"
                        MaxHeight="130"
                        Content="{Binding ImageViewModel}" />

        <ContentControl Grid.Row="1" Grid.Column="0" Content="{Binding LinksViewModel}" Margin="0,0,10,0" />

        <ContentControl Grid.Row="0" Grid.Column="1">
          <Border>
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>

              <Button Grid.Column="0"
                      Width="30" Height="30"
                      ToolTip="Mark as Read"
                      Margin="10,0">
                <Button.Style>
                  <Style TargetType="Button">
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding TradeState}" Value="{x:Static poeTrade:PoeTradeState.New}">
                        <Setter Property="Background" Value="{StaticResource PoeTradeNewItemBrush}" />
                        <Setter Property="BorderThickness" Value="1" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding TradeState}" Value="{x:Static poeTrade:PoeTradeState.Removed}">
                        <Setter Property="Background" Value="{StaticResource PoeTradeRemovedItemBrush}" />
                        <Setter Property="BorderThickness" Value="1" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding TradeState}" Value="{x:Static poeTrade:PoeTradeState.Normal}">
                        <Setter Property="Visibility" Value="Collapsed" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding TradeState}" Value="{x:Static poeTrade:PoeTradeState.Unknown}">
                        <Setter Property="Visibility" Value="Collapsed" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </Button.Style>
                <i:Interaction.Triggers>
                  <i:EventTrigger EventName="Click">
                    <utilities:SetPropertyAction PropertyName="TradeState" TargetObject="{Binding}">
                      <utilities:SetPropertyAction.PropertyValue>
                        <poeTrade:PoeTradeState>Normal</poeTrade:PoeTradeState>
                      </utilities:SetPropertyAction.PropertyValue>
                    </utilities:SetPropertyAction>
                  </i:EventTrigger>
                </i:Interaction.Triggers>
              </Button>

              <Label Grid.Column="1"
                     Content="Corrupted"
                     Foreground="{StaticResource LabelTextBrush}"
                     BorderBrush="{StaticResource ValidationSummaryColor2}"
                     Background="{StaticResource ValidationSummaryColor5}"
                     Height="25"
                     FontWeight="Bold"
                     Margin="10,0"
                     VerticalContentAlignment="Center"
                     VerticalAlignment="Center"
                     Visibility="{Binding Trade.IsCorrupted, Converter={StaticResource BoolFalseToCollapsedConverter}}" />

              <ContentPresenter Grid.Column="2"
                                Content="{Binding Trade}"
                                ContentTemplate="{StaticResource PoeItemNameTemplateKey}"
                                VerticalAlignment="Center"
                                TextBlock.FontSize="16" />

              <Label Grid.Column="3" Content="{Binding Trade.Requirements, Mode=OneWay}"
                     BorderBrush="{StaticResource AccentColorBrush}"
                     BorderThickness="2,0,2,0"
                     VerticalContentAlignment="Center"
                     Margin="10,5,10,5"
                     Visibility="{Binding Trade.Requirements, Converter={StaticResource NullToCollapsedConverter}}" />

              <StackPanel Grid.Column="5"
                          Orientation="Horizontal"
                          VerticalAlignment="Center">
                <Label Content="Last seen: " />
                <Label
                  Content="{Binding TimeElapsedSinceLastIndexation, Mode=OneWay, StringFormat='Last seen: {0} ago', Converter={StaticResource TimeSpanToHumanReadableStringConverter}}"
                  BorderBrush="{StaticResource AccentColorBrush}"
                  ToolTip="{Binding Trade.Timestamp}"
                  Margin="2, 0" />
                <Label Content="ago" />
              </StackPanel>

            </Grid>

          </Border>
        </ContentControl>

        <Border Grid.Row="1" Grid.Column="1"
                BorderThickness="0,2,0,2" BorderBrush="{StaticResource ControlBorderBrush}">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <ContentControl Grid.Column="0"  VerticalAlignment="Center"
                            Content="{Binding Trade}" ContentTemplate="{StaticResource PoeItemStatsTemplateKey}"  />
            <ContentControl Grid.Column="1" 
                            Content="{Binding Trade}" ContentTemplate="{StaticResource PoeItemModsTemplateKey}" />
          </Grid>
        </Border>

        <ContentControl Grid.Row="2" Grid.Column="1"
                        Visibility="{Binding Trade.UserIgn, Converter={StaticResource NullToHiddenConverter}, Mode=OneWay}">
          <Border>
            <Border.Resources>
              <Style TargetType="TextBlock" BasedOn="{StaticResource MetroTextBlockHeaderStyle}">
                <Setter Property="FontSize" Value="13" />
              </Style>
            </Border.Resources>

            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>

              <TextBlock Grid.Column="0"
                         Text="Buyout:" />

              <ContentPresenter Grid.Column="1" Content="{Binding Trade.Price}"
                                ContentTemplate="{StaticResource CurrencyViewKey}" />

              <TextBlock Grid.Column="2"
                         Text="{Binding Path=PriceInChaosOrbs, Mode=OneWay, StringFormat=' (~ {0} chaos)'}"
                         Visibility="{Binding PriceInChaosOrbs, Converter={StaticResource NullToCollapsedConverter}}" />

              <StackPanel Grid.Column="3"
                          Margin="10,2">

                <Button Width="80"
                        Visibility="{Binding IsEnabled, RelativeSource={RelativeSource Self}, Converter={StaticResource BoolFalseToCollapsedConverter}}"
                        Command="{Binding VerifyItemCommand}">
                  <Button.Style>
                    <Style BasedOn="{StaticResource {x:Type Button}}" TargetType="{x:Type Button}">
                      <Setter Property="Content" Value="Verify" />
                      <Setter Property="IsEnabled" Value="True" />
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding VerificationState}" Value="InProgress">
                          <Setter Property="IsEnabled" Value="False" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding VerificationState}" Value="Sold">
                          <Setter Property="Content" Value="Sold" />
                          <Setter Property="Foreground" Value="{StaticResource PoeTradeRemovedItemBrush}" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding VerificationState}" Value="Verified">
                          <Setter Property="Content" Value="Verified" />
                          <Setter Property="Foreground" Value="{StaticResource PoeTradeNewItemBrush}" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding VerificationState}" Value="InProgress">
                          <Setter Property="Content" Value="Working..." />
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </Button.Style>
                </Button>
              </StackPanel>

              <Button Grid.Column="5"
                      Margin="10,2"
                        Visibility="{Binding IsEnabled, RelativeSource={RelativeSource Self}, Converter={StaticResource BoolFalseToCollapsedConverter}}"
                      Content="Go to forum thread" Command="{Binding OpenForumUriCommand}" />

              <Ellipse Grid.Column="6"
                       Width="14" Height="14"
                       Margin="10,2,5,0"
                       StrokeThickness="1"
                       Stroke="{StaticResource LabelTextBrush}"
                       VerticalAlignment="Center">
                <Ellipse.Style>
                  <Style TargetType="Ellipse">
                    <Setter Property="Fill" Value="{StaticResource PoeTradeNewItemBrush}" />
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding Trade.UserIsOnline}" Value="False">
                        <Setter Property="Fill" Value="{StaticResource PoeTradeRemovedItemBrush}" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </Ellipse.Style>
              </Ellipse>

              <TextBlock Grid.Column="7"
                         Text="{Binding Path=Trade.UserIgn, Mode=OneWay, StringFormat='IGN: {0}'}" />

              <Button Grid.Column="8"
                      Command="{Binding CopyPmMessageToClipboardCommand}"
                      Width="30" Height="30" Style="{StaticResource MetroCircleButtonStyle}"
                      FontFamily="{DynamicResource FontAwesome}"
                      Content="{x:Static net:FontAwesome.clipboard}"
                      ToolTip="Copy PM to clipboard" />
            </Grid>
          </Border>
        </ContentControl>

      </Grid>
    </ContentControl>
  </DataTemplate>

</ResourceDictionary>